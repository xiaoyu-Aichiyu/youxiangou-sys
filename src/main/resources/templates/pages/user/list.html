<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<!-- 引入样式 -->
<link rel="stylesheet" href="plugins/element-ui/index.css">
<link rel="stylesheet" href="styles/common/common.css">


<div id="member-app" class="dashboard-container">
    <div class="container">
        <div class="tableBar">
            <div class="el-input el-input--prefix el-input--suffix" style="width: 250px;">
                <input type="text" autocomplete="off" placeholder="请输入员工姓名" class="el-input__inner" id="searchNameId">
                <span class="el-input__prefix">
                    <i class="el-input__icon el-icon-search" style="cursor: pointer;"></i>
                </span>
            </div>
            <button type="button" class="el-button el-button--primary">
                <span>删除员工</span>
            </button>
            <button type="button" class="el-button el-button--primary">
                <span>+ 添加员工</span>
            </button>
        </div>
        <div class="el-table tableBox el-table--fit el-table--striped el-table--enable-row-hover">
            <div class="hidden-columns">
                <div></div>
                <div></div>
                <div></div>
                <div></div>
                <div></div>
            </div>
            <div class="el-table__header-wrapper">
                <table cellspacing="0" cellpadding="0" border="0" class="el-table__header" style="width: 100%;">
                    <thead class="">
                        <tr class="">
                            <th colspan="1" rowspan="1" class="el-table_1_column_1 is-leaf">
                                <div class="cell">ID</div>
                            </th>
                            <th colspan="1" rowspan="1" class="el-table_1_column_2 is-leaf">
                                <div class="cell">员工姓名</div>
                            </th>
                            <th colspan="1" rowspan="1" class="el-table_1_column_3 is-leaf">
                                <div class="cell">账号</div>
                            </th>
                            <th colspan="1" rowspan="1" class="el-table_1_column_4 is-leaf">
                                <div class="cell">头像</div>
                            </th>
                            <th colspan="1" rowspan="1" class="el-table_1_column_5 is-leaf">
                                <div class="cell">手机号</div>
                            </th>
                            <th colspan="1" rowspan="1" class="el-table_1_column_6 is-leaf">
                                <div class="cell">账号状态</div>
                            </th>
                            <th colspan="1" rowspan="1" class="el-table_1_column_7 is-leaf">
                                <div class="cell">性别</div>
                            </th>
                            <th colspan="1" rowspan="1" class="el-table_1_column_8 is-center is-leaf">
                                <div class="cell">操作</div>
                            </th>
                        </tr>
                    </thead>
                </table>
            </div>
            <div class="el-table__body-wrapper is-scrolling-none">
                <table cellspacing="0" cellpadding="0" border="0" class="el-table__body" style="width: 100%;">
                    <tbody id="tbodyId"></tbody>
                </table>
                <div class="el-table__empty-block" style="height: 100%; width: 100%;display: none">
                    <span class="el-table__empty-text">暂无数据</span>
                </div>
            </div>
            <div class="el-table__column-resize-proxy" style="display: none;"></div>
        </div>
        <div class="pageList el-pagination" id="pageId">

        </div>
    </div>
</div>
<script>
    $(function() {
        $(".el-button--primary").on("click", addPage);
        $(".el-input__inner").on("click",doGetObjects)
        doGetObjects();
        $("#pageId").load("page/page",function(){

        })

    })
    function doGetObjects(){
        var url = "user/findUser";
        var curPage = $("#pageId").data("curPage");
        var params = {
            "name" : $("#searchNameId").val(),
            "curPage" :curPage ? curPage : 1,
            "pageSize" : 10
        };
        $.get(url,params,function(result){
            if(result.state == 0){
                alert(result.message);
            }else{
                loadRoleData(result.data.pageData);//加载表格主体数据
                setPageData(result.data);//分页
            }
        })
    }
    function loadRoleData(data) {
        var tbody = $("#tbodyId");
        tbody.empty();
        for (var i = 0;i < data.length;i++){
            var d = data[i];
            var tr = "<tr><td  class='el-table_1_column_1 is-leaf' colspan='1' rowspan='1'><input type='radio' name='radioId' value='"+d.id+"' name='userRadio'></td>"
                +"<td class='el-table_1_column_2 is-leaf' colspan='1' rowspan='1'><div class='cell'>" + d.name + "</div></td>"
                +"<td class='el-table_1_column_3 is-leaf' colspan='1' rowspan='1'><div class='cell'>" + d.username + "</div></td>"
                +"<td class='el-table_1_column_4 is-leaf' colspan='1' rowspan='1'><div class='cell'>"+d.userImg+"</div></td>"
                +"<td class='el-table_1_column_5 is-leaf' colspan='1' rowspan='1'><div class='cell'>"+d.phone+"</div></td>"
                +"<td class='el-table_1_column_6 is-leaf' colspan='1' rowspan='1'><div class='cell'>"+(d.state == 1 ? "启用":"禁用")+"</div></td>"
                +"<td class='el-table_1_column_7 is-leaf' colspan='1' rowspan='1'><div class='cell'>"+d.gender+"</div></td>"
                +"<td class='el-table_1_column_8 is-leaf' colspan='1' rowspan='1'><div class='cell'>"
                +"<button type='button' class='el-button--primary' onclick='changeValid(this)'>"+(d.state == 1 ?"启用":"禁用")+"</button>"
                +"<button type='button' class='el-button--primary' onclick='updateValid(this)'>修改</button></div></td></tr>";
            tbody.append(tr);
            //每一行上面绑定当前行数据
            $("#tbodyId tr:last").data("user",data[i]);
        }
    }
    //修改状态
    function changeValid(btn){
        //找到当前行id
        var id =$(btn).parents('tr').find("input").val();
        var url = "user/updateValId";
        var state = $(btn).text() == '禁用' ? 0 : 1;
        var params = {id : id,valid : state};
        $.get(url,params,function(result){
            alert(result.message);
            $(btn).text(state == 0 ? "启用" : "禁用");
            $(btn).parents('tr').children(":eq(5)").html("<div class='cell'>"+(state == 1 ? "启用":"禁用")+"</div>");
        })
    }
    //跳转添加页面
    function addPage() {
        $("#cIframe").load("user/add");
    }
</script>
<script src="api/member/member.js"></script>